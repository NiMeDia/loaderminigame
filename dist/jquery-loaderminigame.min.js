/*
 *  jquery-loaderminigame - v1.0.0
 *  HTML5 / CSS3 loading animation minigame shipped as JQuery plugin.
 *  http://github.com/P0rnflake/loaderminigame
 *
 *  Made by P0rnflake
 *  Under MIT License
 */

!function(a,b){"function"==typeof define&&define.amd?define("loaderminigame",["jquery"],function(c){return a.$=b(c)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery")):a.$=b(a.jQuery)}(this,function(a){function b(b,c,d,e,f,g){this.config=a.extend({loaderBorderSize:"4px",loaderBorderColor:"#666",loaderOpenBorderColor:"transparent",loaderAnimationTimings:["linear","ease","ease-in","ease-out","ease-in-out"],baseLoaderBorders:["NE","SE","SW"],baseLoaderWidth:20,baseLoaderHeight:20,minLoaderSpeed:1,maxLoaderSpeed:3},c),this.element=null,this.blockedRanges=[],this.scale=e||1,this.borders=d||["NE","SE","SW"],this.animationDuration=g||Math.random()*(this.config.maxLoaderSpeed-this.config.minLoaderSpeed)+this.config.minLoaderSpeed+"s",this.animationTimings=this.config.loaderAnimationTimings||["linear","ease","ease-in","ease-out","ease-in-out"],this.animationTiming=f||this.animationTimings[Math.floor(Math.random()*this.animationTimings.length)],this.animations=["loaderminigame_spin_reversed","loaderminigame_spin"],this.__initialize=function(){this.element=a('<div class="loaderminigame_loader"></div>'),this.element.hide(),this.element.css("position","absolute"),this.element.css("top","50%"),this.element.css("left","50%"),this.element.css("border",this.config.loaderBorderSize+" solid "+this.config.loaderOpenBorderColor),this.element.css("border-radius","50%"),this.element.css("width",this.config.baseLoaderWidth*e),this.element.css("height",this.config.baseLoaderHeight*e),this.element.css("transform","translate(-50%, -50%)"),this.element.css("animation",this.animations[Math.floor(Math.random()*this.animations.length)]+" "+this.animationDuration+" "+this.animationTiming+" infinite");for(var c=0;c<this.borders.length;c++)switch(this.borders[c]){case"NE":this.element.css("border-top",this.config.loaderBorderSize+" solid "+this.config.loaderBorderColor),this.blockedRanges.push([0,90]);break;case"SE":this.element.css("border-right",this.config.loaderBorderSize+" solid "+this.config.loaderBorderColor),this.blockedRanges.push([90,180]);break;case"SW":this.element.css("border-bottom",this.config.loaderBorderSize+" solid "+this.config.loaderBorderColor),this.blockedRanges.push([180,270]);break;case"NW":this.element.css("border-left",this.config.loaderBorderSize+" solid "+this.config.loaderBorderColor),this.blockedRanges.push([270,360])}a(b).append(this.element),this.element.fadeIn("slow")},this.isPassable=function(a){for(var b=this.getCurrentRotation(),c=0;c<this.blockedRanges.length;c++){var d=this.blockedRanges[c][0]+b;d>=360&&(d-=360);var e=this.blockedRanges[c][1]+b;if(e>=360&&(e-=360),a>=d){if(d>e)return!1;if(a<e)return!1}if(a<=e&&d>e)return!1}return!0},this.pause=function(){this.element.css("-webkit-animation-play-state","paused"),this.element.css("-moz-animation-play-state","paused"),this.element.css("-ms-animation-play-state","paused"),this.element.css("-o-animation-play-state","paused"),this.element.css("animation-play-state","paused")},this.resume=function(){this.element.css("-webkit-animation-play-state","running"),this.element.css("-moz-animation-play-state","running"),this.element.css("-ms-animation-play-state","running"),this.element.css("-o-animation-play-state","running"),this.element.css("animation-play-state","running")},this.destroy=function(a){var b=this;b.element.animate({opacity:0},250,"swing",function(){b.element.animate({opacity:.8},250,"swing",function(){b.element.animate({opacity:0},250,"swing",function(){b.element.remove(),a()})})})},this.getCurrentRotation=function(){var a=315,b=this.element.css("-webkit-transform")||this.element.css("-moz-transform")||this.element.css("-ms-transform")||this.element.css("-o-transform")||this.element.css("transform")||"fail...";if("none"!==b){var c=b.split("(")[1];c=c.split(")")[0],c=c.split(",");var d=c[0],e=c[1],f=Math.atan2(e,d);f<0&&(f+=2*Math.PI),a=Math.round(f*(180/Math.PI)),a-=45,a<0&&(a=360+a)}return a},this.__initialize()}function c(c,d){this.config=a.extend({zindex:9999,background:"rgba(255, 255, 255, 0.4)",loaderBorderSize:"4px",loaderBorderColor:"#666",loaderOpenBorderColor:"transparent",loaderAnimationTimings:["linear","ease","ease-in","ease-out","ease-in-out"],baseLoaderCount:1,baseLoaderAnimationTiming:"linear",baseLoaderBorders:["NE","SE","SW"],baseLoaderWidth:20,baseLoaderHeight:20,minLoaderSpeed:1,maxLoaderSpeed:3},d);var e=this;if(this.parent=null,this.element=null,this.winPoint=null,this.mousePoint=null,this.loaders=[],this.__initialize=function(b){if(void 0!==b[0].loaderminigameInstance)return b[0].loaderminigameInstance;this.parent=b,0===a("#loaderminigame_css_injection").length&&a("body").append('<div id="loaderminigame_css_injection"><style>@keyframes loaderminigame_spin {0% { transform: translate(-50%, -50%) rotate(0deg); }100% { transform: translate(-50%, -50%) rotate(360deg); }}@keyframes loaderminigame_spin_reversed {0% { transform: translate(-50%, -50%) rotate(360deg); }100% { transform: translate(-50%, -50%) rotate(0deg); }}</style></div>'),"absolute"!==b.css("position")&&"relative"!==b.css("position")&&"fixed"!==b.css("position")&&(console.log("LoaderMiniGame::initialize: Parent object must be position absolute, relative or fixed -> changing it to relative..."),b.css("position","relative")),this.element=a('<div class="loaderminigame_wrapper"></div>'),this.element.css("width","100%"),this.element.css("height","100%"),this.element.css("position","absolute"),this.element.css("padding",0),this.element.css("margin",0),this.element.css("z-index",this.config.zindex),this.element.css("background",this.config.background),this.element.css("top",0),this.element.css("bottom",0),this.element.css("left",0),this.element.css("right",0),this.element.css("overflow","hidden"),this.element.on("click",this.__handleClickInteraction),this.element.on("mousemove",this.__handleMouseMove),this.winPoint=a('<div class="loaderminigame_win"></div>'),this.winPoint.css("width","0px"),this.winPoint.css("height","0px"),this.winPoint.css("border","1px solid "+this.config.loaderBorderColor),this.winPoint.css("position","absolute"),this.winPoint.css("border-radius","50%"),this.winPoint.css("padding",0),this.winPoint.css("margin",0),this.winPoint.css("top","50%"),this.winPoint.css("left","50%"),this.winPoint.css("transform","translate(-50%, -50%)"),this.element.append(this.winPoint),this.mousePoint=a('<div class="loaderminigame_win"></div>'),this.mousePoint.css("width","4px"),this.mousePoint.css("height","4px"),this.mousePoint.css("position","absolute"),this.mousePoint.css("border-radius","50%"),this.mousePoint.css("background","red"),this.mousePoint.css("padding",0),this.mousePoint.css("margin",0),this.mousePoint.css("top","50%"),this.mousePoint.css("left","50%"),this.mousePoint.css("transform","translate(-50%, -50%)"),this.element.append(this.mousePoint);for(var c=0;c<this.config.baseLoaderCount;c++)this.__addLoader();b.append(this.element),b[0].loaderminigameInstance=this},this.__handleMouseMove=function(a){var b=e.__getCurrentCursorRadians(a),c=e.__getNextLoaderScale(),d=(e.config.baseLoaderWidth*c+10)*Math.cos(b)*-1/2,f=(e.config.baseLoaderHeight*c+10)*Math.sin(b)*-1/2;e.mousePoint.css("left",e.winPoint.position().left+d+"px"),e.mousePoint.css("top",e.winPoint.position().top+f+"px")},this.__handleClickInteraction=function(a){e.__stop();for(var b=e.__getCurrentCursorAngle(a),c=null,d=0;d<e.loaders.length;d++){e.loaders[d].isPassable(b)||(c=e.loaders[d])}c?e.__removeOutestLoader(function(){e.__start()}):(e.mousePoint.animate({top:e.winPoint.position().top+1,left:e.winPoint.position().left+1},1e3),e.winPoint.animate({width:10,height:10},1e3,"linear",function(){e.winPoint.animate({width:0,height:0},500,"linear"),e.__addLoader(),e.__start()}))},this.__getCurrentCursorRadians=function(a){var b=a.clientY,c=a.clientX,d=e.winPoint[0].getBoundingClientRect(),f=d.top+e.winPoint.height()/2,g=d.left+e.winPoint.width()/2,h=Math.atan2(f-b,g-c);return h<0&&(h+=2*Math.PI),h},this.__getCurrentCursorAngle=function(a){var b=e.__getCurrentCursorRadians(a),c=Math.round(b*(180/Math.PI));return c-=90,c<0&&(c=360+c),c},this.__addLoader=function(){if(this.loaders.length<this.config.baseLoaderCount)return void this.loaders.push(new b(this.element,this.config,this.config.baseLoaderBorders,this.__getNextLoaderScale(),this.config.baseLoaderAnimationTiming));for(var a=["NE","SE","SW","NW"],c=Math.floor(3*Math.random())+1,d=0;d<c;d++)a.splice(Math.floor(Math.random()*a.length),1);this.loaders.push(new b(this.element,this.config,a,this.__getNextLoaderScale()))},this.__removeOutestLoader=function(a){if(this.loaders.length>this.config.baseLoaderCount){this.loaders.splice(this.loaders.length-1,1)[0].destroy(a)}else a()},this.__getNextLoaderScale=function(){return 1+(this.loaders.length+1)/1.5},this.__bindUserControlls=function(){this.__unbindUserControlls(),this.element.on("click",this.__handleClickInteraction),this.element.on("mousemove",this.__handleMouseMove)},this.__unbindUserControlls=function(){this.element.unbind("click"),this.element.unbind("mousemove")},this.__start=function(){this.__bindUserControlls();for(var a=0;a<e.loaders.length;a++){e.loaders[a].resume()}},this.__stop=function(){this.__unbindUserControlls();for(var a=0;a<e.loaders.length;a++){e.loaders[a].pause()}},this.destroy=function(a){"object"!=typeof a&&(a={duration:"fast"});var b=null;"function"==typeof a.always&&(b=a.always),a.always=function(){b&&b.apply(arguments),e.parent[0].loaderminigameInstance=void 0,e.element.remove()},e.element.fadeOut(a)},void 0===a(c)[0])throw"No object to bind the loaderminigame.";this.__initialize(a(a(c)[0]))}return a.fn.loaderminigame=function(a){var b=this,d={destroy:function(a){return b.each(function(){var b=this;b._loadergameInstance.destroy(a),b._loadergameInstance=void 0}),d},init:function(){b.each(function(){var b=this;void 0===b._loadergameInstance&&(b._loadergameInstance=new c(b,a))})}};return d.init(),d},a});